// Generated by CoffeeScript 1.6.2
(function() {
  var ExpressChat;

  ExpressChat = {};

  ExpressChat.View = Backbone.View.extend({
    el: "#application",
    events: {
      "click .submit": "sendMessage"
    },
    initialize: function() {
      var faye, subscription,
        _this = this;

      _.each(window.messages, function(message) {
        return _this.renderMessage(message);
      });
      faye = new Faye.Client('http://192.168.0.104:3000/faye');
      return subscription = faye.subscribe('/chat-messages', function(message) {
        return _this.renderMessage(message);
      });
    },
    sendMessage: function(event) {
      var emailField, messageField, payload,
        _this = this;

      event.preventDefault();
      emailField = this.$el.find("#email");
      messageField = this.$el.find("#message");
      payload = {
        email: emailField.val(),
        body: messageField.val()
      };
      messageField.val("");
      return $.ajax('/message', {
        data: payload,
        type: 'POST',
        success: function(data, status, xhr) {}
      });
    },
    renderMessage: function(message) {
      var html;

      html = new EJS({
        url: '/javascripts/chat/_message.ejs'
      }).render({
        message: message
      });
      return $("#messages").append(html);
    }
  });

  $(function() {
    return window.application = new ExpressChat.View();
  });

}).call(this);
